<!DOCTYPE html>
<html>
<head>
    <title>Direct Solution Tab Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Direct Solution Tab Test</h1>
    <p>This test directly fetches and displays solution content.</p>

    <button onclick="testLogicTab()">Test Logic Tab</button>
    <button onclick="testRequirementsTab()">Test Requirements Tab</button>
    <button onclick="testBothTabs()">Test Both Tabs</button>

    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        async function testLogicTab() {
            addResult('info', 'Testing Logic Tab...');

            try {
                const response = await fetch('/level1_500_codelogic.py');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const text = await response.text();
                const problemContent = extractProblemContent(text, 40);

                if (problemContent && problemContent.length > 50) {
                    addResult('success', `‚úÖ Logic Tab SUCCESS: Found ${problemContent.length} chars of content`);
                    addResult('success', `üìÑ Preview: ${problemContent.substring(0, 100)}...`);
                } else {
                    addResult('error', `‚ùå Logic Tab FAILED: No content found (${problemContent.length} chars)`);
                }
            } catch (error) {
                addResult('error', `‚ùå Logic Tab ERROR: ${error.message}`);
            }
        }

        async function testRequirementsTab() {
            addResult('info', 'Testing Requirements Tab...');

            try {
                const response = await fetch('/level1_500_requirements.py');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const text = await response.text();
                const problemContent = extractProblemContent(text, 40);

                if (problemContent && problemContent.length > 50) {
                    addResult('success', `‚úÖ Requirements Tab SUCCESS: Found ${problemContent.length} chars of content`);
                    addResult('success', `üìÑ Preview: ${problemContent.substring(0, 100)}...`);
                } else {
                    addResult('error', `‚ùå Requirements Tab FAILED: No content found (${problemContent.length} chars)`);
                }
            } catch (error) {
                addResult('error', `‚ùå Requirements Tab ERROR: ${error.message}`);
            }
        }

        async function testBothTabs() {
            await testLogicTab();
            await testRequirementsTab();
        }

        function extractProblemContent(fileContent, problemId) {
            const problemMarker = new RegExp(`"""\\s*Problem\\s*:?\\s*${problemId}\\b`, 'm');
            const match = fileContent.match(problemMarker);

            if (!match) {
                return '';
            }

            const startIndex = match.index || 0;
            const remainingContent = fileContent.substring(startIndex);
            const nextProblemPattern = new RegExp(`"""\\s*Problem\\s*:?\\s*\\d+\\b`, 'm');

            let endIndex = remainingContent.length;
            let searchStart = match[0].length;

            while (searchStart < remainingContent.length) {
                const nextMatch = remainingContent.substring(searchStart).match(nextProblemPattern);
                if (!nextMatch) {
                    break;
                }

                const nextProblemNum = nextMatch[0].match(/\d+/);
                if (nextProblemNum && parseInt(nextProblemNum[0]) !== problemId) {
                    endIndex = searchStart + (nextMatch.index || 0);
                    break;
                }

                searchStart += (nextMatch.index || 0) + nextMatch[0].length;
            }

            return remainingContent.substring(0, endIndex).trim();
        }

        // Auto-run test on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('info', 'üîÑ Auto-testing solution tabs...');
                testBothTabs();
            }, 1000);
        });
    </script>
</body>
</html>